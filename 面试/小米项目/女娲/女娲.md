# 1 EVE 广告诊断平台
- **背景**：
依托于广告平台的数据能力，提供收入波动根因分析、广告素材诊断、广告出价诊断、广告主账户预算诊断等功能，集前端、后端、数据处理一体的平台。目的是降低广告销售、运营排查问题的门槛，方便其对广告投放方式做优化。
- **承担角色**：
负责收入诊断功能数据侧和后台开发(SpringBoot/Flink/Kafka/Redis)
- **解决难点**：
    1. 引入多维度分层下钻分析算法完成广告收入根因分析功能：选择一个维度（tagId），计算该维度下每个维度分量（tagId=x1,x2,...）的收入变化率的变异系数（归一化标准差）。
        - 下钻标准：    
            - 收入变化>diff_threshold * 总收入变化
            - 过滤了变异系数 \< cv_threshold的维度
    2. 解决Spark任务数据倾斜问题，保证数据实时性(cache broadcast 两阶段聚合)
    3. 解决 Flink 作业消费堆积问题（QPS？）
        - 利用 Redis 缓存下发数据，避免两个 Kafka 流 join 时的 shuffle 问题
        - 采用 map-side 端预聚合，解决 window 聚合时网络传输开销
        - 利用 Flink 反压机制定位耗时大的算子，从而优化代码减小计算量降低耗时？？
        - （合理设置并发度避免Rebalance）
    4. 数据库优化 ？？
        - 索引






```    
**成绩**：
    1. 根因分析准确率？？
    2. 收入根因分析作业在一小时以内完成，保证诊断平台实时性
    3. Flink 作业不堆积
```

# 2 吞吐量?
- de：12000 QPS  480 partition
- ad_log_v2：120000 QPS  168 partition


redis 
UNICACHE3	
c3: 400GB

c4: 400GB

c3: 40

c4: 40

c3: 232k

c4: 85.8k

c3: 37%

c4: 37%

通用集群6	

ad-uni-cache2-c3

ad-uni-cache2-c4